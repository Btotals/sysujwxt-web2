// Generated by CoffeeScript 1.4.0
(function() {
  var drawData, genGChartUrl, getDistributedScore, getScore;

  getScore = function(year, term) {
    return $.get('/api/score', {
      year: year,
      term: term
    });
  };

  genGChartUrl = function(scores, type) {
    var url;
    scores = scores.join(",");
    return url = "http://chart.apis.google.com/chart?chs=600x200&chd=t:" + scores + "&cht=p3&chhco=ff0000&chl=<60|60-69|70-79|80-89|90-100";
  };

  getDistributedScore = function(scores) {
    var detail, ret, score, _i, _len;
    ret = [['ID', '分数', '学分', '时间', '绩点']];
    for (_i = 0, _len = scores.length; _i < _len; _i++) {
      score = scores[_i];
      detail = [];
      detail.push(score.jxbmc && score.kcmc ? score.jxbmc + score.kcmc : score.jxbmc || score.kcmc);
      detail.push(parseFloat(score.zzcj));
      detail.push(parseFloat(score.xf));
      detail.push(score.xnd);
      detail.push(parseFloat(score.jd));
      ret.push(detail);
    }
    return ret;
  };

  drawData = function(data) {
    var chart, options;
    data = google.visualization.arrayToDataTable(data);
    options = {
      title: '大学成绩分布图',
      hAxis: {
        title: '分数'
      },
      vAxis: {
        title: '学分',
        minValue: 0,
        maxValue: 7
      },
      bubble: {
        textStyle: {
          color: 'none'
        }
      }
    };
    chart = new google.visualization.BubbleChart(document.getElementById('gpa-chart'));
    return chart.draw(data, options);
  };

  $(function() {
    return $("#gpa-query-btn").click(function() {
      return getScore().done(function(res) {
        var distributedScore, scores;
        scores = eval("scores =" + res).body.dataStores.kccjStore.rowSet.primary;
        distributedScore = getDistributedScore(scores);
        console.log(distributedScore);
        return drawData(distributedScore);
      });
    });
  });

}).call(this);
